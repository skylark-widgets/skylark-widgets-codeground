/**
 * skylark-widgets-codeground - The skylark code playground widget for showcasing html/css/js.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-widgets/skylark-widgets-codeground/
 * @license MIT
 */
define(["skylark-langx/skylark","skylark-langx/langx","skylark-widgets-base/Widget","skylark-domx-styler","skylark-domx-data","./util","./template","./addons"],function(t,e,s,a,i,n,r,l){"use strict";class o extends s{get klassName(){return"CodeGround"}get pluginName(){return"lark.CodeGround"}get options(){return{files:[],showBlank:!1,runScripts:!0,pane:"result",debounce:250,addons:{general:["render"]}}}_init(t,s){var a=this.options;!1===a.runScripts&&a.addons.gerneral.push("scriptless"),super._init();var i={};this._get=function(t){return i[t]},this._set=function(t,e){return i[t]=e,i[t]},this._set("cachedContent",{html:null,css:null,js:null});this.$container=this._elm;var n=this._set("paneActive",a.pane);this._velm.html(r.container()).addClass(r.containerClass()).addClass(r.paneActiveClass(n)).on("keyup",e.debounce(this.change.bind(this),a.debounce)).on("change",e.debounce(this.change.bind(this),a.debounce)).on("click",this.pane.bind(this)),this._set("$status",{});for(let t of["html","css","js"])this.markup(t)}_startup(){var t=this.options;this.paneActive=this._get("paneActive");for(let t of["html","css","js"])this.load(t);if(t.showBlank)for(let t of["html","css","js"])this._velm.addClass(r.hasFileClass(t))}findFile(t){var e=this.options;for(let s in e.files){let a=e.files[s];if(a.type===t)return a}return{}}markup(t){var e=this._elm,s=e.querySelector(`.codeg-pane-${t}`),i=this.findFile(t),n=document.createElement("div");n.innerHTML=r.editorContent(t,i.url),n.className=r.editorClass(t),s.appendChild(n),this._get("$status")[t]=s.querySelector(".codeg-status"),void 0===i.url&&void 0===i.content||a.addClass(e,r.hasFileClass(t))}load(t){var e=this.findFile(t),s=this._elm.querySelector(`.codeg-pane-${t} textarea`);void 0!==e.content?this.setValue(s,e.content):void 0!==e.url?(this.status("loading",[r.statusLoading(e.url)],{type:t,file:e}),n.fetch(e.url,(e,a)=>{e?this.status("error",[r.statusFetchError(e)],{type:t}):(this.clearStatus("loading",{type:t}),this.setValue(s,a))})):this.setValue(s,"")}setValue(t,e){t.value=e,this.change({target:t})}change(t){var e=i.data(t.target,"codeg-type");if(e){var s=this._get("cachedContent");s[e]!==t.target.value&&(s[e]=t.target.value,this.emit("change",{type:e,file:i.data(t.target,"codeg-file"),content:s[e]}))}}errors(t,e){this.status("error",t,e)}pane(t){if(i.data(t.target,"codeg-type")){var e=this._elm,s=this._get("paneActive");a.removeClass(e,r.paneActiveClass(s)),s=this._set("paneActive",i.data(t.target,"codeg-type")),a.addClass(e,r.paneActiveClass(s)),t.preventDefault()}}status(t="error",e=[],s={}){if(!e.length)return this.clearStatus(t,s);var i=this._get("$status");a.addClass(i[s.type],r.statusClass(t)),a.addClass(this._elm,r.statusActiveClass(s.type));var n="";e.forEach(function(t){n+=r.statusMessage(t)}),i[s.type].innerHTML=n}clearStatus(t,e){var s=this._get("$status");a.removeClass(s[e.type],r.statusClass(t)),a.removeClass(this._elm,r.statusActiveClass(e.type)),s[e.type].innerHTML=""}}return o.addons=l,t.attach("widgets.CodeGround",o)});
//# sourceMappingURL=sourcemaps/code_ground.js.map
