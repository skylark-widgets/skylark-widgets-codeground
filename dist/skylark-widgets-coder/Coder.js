/**
 * skylark-widgets-coder - The skylark code editor widget for showcasing html/css/js.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-widgets/skylark-widgets-coder/
 * @license MIT
 */
define(["skylark-langx/skylark","skylark-langx/langx","skylark-widgets-base/Widget","skylark-domx-styler","skylark-domx-data","./util","./template","./plugin"],function(t,e,s,a,i,r,n,l){"use strict";class u extends s{get klassName(){return"Coder"}get pluginName(){return"lark.coder"}get options(){return{files:[],showBlank:!1,runScripts:!0,pane:"result",debounce:250,plugins:[]}}_init(t,s){var i={};this._get=function(t){return i[t]},this._set=function(t,e){return i[t]=e,i[t]};var r=this.options;r.plugins.push("render"),!1===r.runScripts&&r.plugins.push("scriptless"),this._set("cachedContent",{html:null,css:null,js:null});var u=this.$container=this._elm;u.innerHTML=n.container(),a.addClass(u,n.containerClass());var d=this._set("paneActive",r.pane);a.addClass(u,n.paneActiveClass(d)),this._set("$status",{});for(let t of["html","css","js"])this.markup(t);u.addEventListener("keyup",e.debounce(this.change.bind(this),r.debounce)),u.addEventListener("change",e.debounce(this.change.bind(this),r.debounce)),u.addEventListener("click",this.pane.bind(this)),this.paneActive=this._get("paneActive"),this._set("plugins",{}),l.init.call(this);for(let t of["html","css","js"])this.load(t);if(r.showBlank)for(let t of["html","css","js"])a.addClass(u,n.hasFileClass(t))}findFile(t){var e=this.options;for(let s in e.files){let a=e.files[s];if(a.type===t)return a}return{}}markup(t){var e=this._elm,s=e.querySelector(`.coder-pane-${t}`),i=this.findFile(t),r=document.createElement("div");r.innerHTML=n.editorContent(t,i.url),r.className=n.editorClass(t),s.appendChild(r),this._get("$status")[t]=s.querySelector(".coder-status"),void 0===i.url&&void 0===i.content||a.addClass(e,n.hasFileClass(t))}load(t){var e=this.findFile(t),s=this._elm.querySelector(`.coder-pane-${t} textarea`);void 0!==e.content?this.setValue(s,e.content):void 0!==e.url?(this.status("loading",[n.statusLoading(e.url)],{type:t,file:e}),r.fetch(e.url,(e,a)=>{e?this.status("error",[n.statusFetchError(e)],{type:t}):(this.clearStatus("loading",{type:t}),this.setValue(s,a))})):this.setValue(s,"")}setValue(t,e){t.value=e,this.change({target:t})}change(t){var e=i.data(t.target,"coder-type");if(e){var s=this._get("cachedContent");s[e]!==t.target.value&&(s[e]=t.target.value,this.emit("change",{data:{type:e,file:i.data(t.target,"coder-file"),content:s[e]}}))}}errors(t,e){this.status("error",t,e)}pane(t){if(i.data(t.target,"coder-type")){var e=this._elm,s=this._get("paneActive");a.removeClass(e,n.paneActiveClass(s)),s=this._set("paneActive",i.data(t.target,"coder-type")),a.addClass(e,n.paneActiveClass(s)),t.preventDefault()}}status(t="error",e=[],s={}){if(!e.length)return this.clearStatus(t,s);var i=this._get("$status");a.addClass(i[s.type],n.statusClass(t)),a.addClass(this._elm,n.statusActiveClass(s.type));var r="";e.forEach(function(t){r+=n.statusMessage(t)}),i[s.type].innerHTML=r}clearStatus(t,e){var s=this._get("$status");a.removeClass(s[e.type],n.statusClass(t)),a.removeClass(this._elm,n.statusActiveClass(e.type)),s[e.type].innerHTML=""}}return u.plugin=function(){return l.register.apply(this,arguments)},t.attach("widgets.Coder",u)});
//# sourceMappingURL=sourcemaps/Coder.js.map
