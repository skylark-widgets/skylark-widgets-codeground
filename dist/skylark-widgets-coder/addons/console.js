/**
 * skylark-widgets-coder - The skylark code editor widget for showcasing html/css/js.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-widgets/skylark-widgets-coder/
 * @license MIT
 */
define(["../util","../Coder"],function(e,t){"use strict";class n{constructor(t,n){n=e.extend(n,{autoClear:!1});var o=`(function ${this.capture.toString()})();`,i=document.createElement("li");e.addClass(i,"coder-nav-item coder-nav-item-console"),i.innerHTML='<a href="#" data-coder-type="console">JS Console</a>';var r=document.createElement("div");e.addClass(r,"coder-pane coder-pane-console"),r.innerHTML='\n              <div class="coder-console-container">\n                <ul class="coder-console-output"></ul>\n                <form class="coder-console-input">\n                  <input type="text">\n                </form>\n              </div>\n              <button class="coder-button coder-console-clear">Clear</button>\n            ',t.$container.appendChild(r),t.$container.querySelector(".coder-nav").appendChild(i);var s=t.$container.querySelector(".coder-console-container"),c=t.$container.querySelector(".coder-console-output"),a=t.$container.querySelector(".coder-console-input input"),l=t.$container.querySelector(".coder-console-input"),h=t.$container.querySelector(".coder-console-clear");l.addEventListener("submit",this.submit.bind(this)),a.addEventListener("keydown",this.history.bind(this)),h.addEventListener("click",this.clear.bind(this)),!0===n.autoClear&&t.on("change",this.autoClear.bind(this),29),t.on("change",this.change.bind(this),30),window.addEventListener("message",this.getMessage.bind(this)),this.$coderContainer=t.$container,this.$container=s,this.$input=a,this.$output=c,this.history=[],this.historyIndex=0,this.logCaptureSnippet=o,this.contentCache={html:"",css:"",js:""},this.getIframe=this.getIframe.bind(this)}getIframe(){return this.$coderContainer.querySelector(".coder-pane-result iframe")}getMessage(e){if(e.source===this.getIframe().contentWindow){var t={};try{t=JSON.parse(e.data)}catch(e){}"coder-console-log"===t.type&&this.log(t.message)}}autoClear(e,t){var n=e.content;"js"===e.type&&(n=n.replace(this.logCaptureSnippet,"")),!0!==e.forceRender&&this.contentCache[e.type]===n||this.clear(),this.contentCache[e.type]=n,t(null,e)}change(e,t){if("js"!==e.type)return t(null,e);-1===e.content.indexOf(this.logCaptureSnippet)&&(e.content=`${this.logCaptureSnippet}${e.content}`),t(null,e)}capture(){void 0!==window.console&&void 0!==window.console.log||(window.console={log:function(){}});var e=Function.prototype.bind.call(window.console.log,window.console);window.console.log=function(){[].slice.call(arguments).forEach(function(e){window.parent.postMessage(JSON.stringify({type:"coder-console-log",message:e}),"*")}),e.apply(e,arguments)}}log(t="",n){var o=document.createElement("li");e.addClass(o,"coder-console-log"),void 0!==n&&e.addClass(o,`coder-console-log-${n}`),o.innerHTML=t,this.$output.appendChild(o)}submit(e){var t=this.$input.value.trim();if(""===t)return e.preventDefault();this.history.push(t),this.historyIndex=this.history.length,this.log(t,"history"),0!==t.indexOf("return")&&(t="return "+t);try{var n=this.getIframe().contentWindow.eval(`(function() {${t}})()`);this.log(n)}catch(e){this.log(e,"error")}this.$input.value="",this.$container.scrollTop=this.$container.scrollHeight,e.preventDefault()}clear(){this.$output.innerHTML=""}history(e){var t=!1,n=this.$input.selectionStart;38===e.keyCode&&0!==this.historyIndex&&0===n&&(this.historyIndex--,t=!0),40===e.keyCode&&this.historyIndex!==this.history.length-1&&n===this.$input.value.length&&(this.historyIndex++,t=!0),t&&(this.$input.value=this.history[this.historyIndex])}}return t.plugin("console",n),n});
//# sourceMappingURL=../sourcemaps/addons/console.js.map
