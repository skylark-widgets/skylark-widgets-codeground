{"version":3,"sources":["addons/edit/codemirror.js"],"names":["define","langx","datax","CodeMirror","Addon","util","Coder","AddonCodeMirror","options","lineNumbers","pluginCssClass","[object Object]","super","_init","i","coder","this","editor","modemap","html","$editors","$container","querySelectorAll","length","$textarea","querySelector","type","data","file","fromTextArea","setOption","getMode","on","change","bind","params","content","getValue","emit","e","callback","cmEditor","setValue","editorChange","categoryName","addonName","register"],"mappings":";;;;;;;AAAAA,QACI,sBACA,oBACA,gCACA,cACA,aACA,eACD,SAAUC,EAAMC,EAAMC,EAAWC,EAAMC,EAAKC,GAC3C,mBACMC,UAAyBH,EAG3BI,cACI,OACGC,aAAa,EACbC,eAAiB,2BAIxBC,QACIC,MAAMC,QACN,IAIIC,EAJAC,EAAQC,KAAKD,MACbP,EAAUQ,KAAKR,QAInBQ,KAAKC,UAEL,IAAIC,GAAYC,KAAQ,aAKpBC,GAJAZ,EAAUQ,KAAKR,QAIJO,EAAMM,WAAWC,iBAAiB,kBACjD,IAAKR,EAAI,EAAGA,EAAIM,EAASG,OAAQT,IAAK,CAClC,IAAIU,EAAYJ,EAASN,GAAGW,cAAc,YACtCC,EAAOxB,EAAMyB,KAAKH,EAAW,cAC7BI,EAAO1B,EAAMyB,KAAKH,EAAW,cACjCR,KAAKC,OAAOS,GAAQvB,EAAW0B,aAAaL,EAAWhB,GACvDQ,KAAKC,OAAOS,GAAMI,UAAU,OAAQzB,EAAK0B,QAAQL,EAAME,EAAMV,IAEjEH,EAAMiB,GAAG,SAAUhB,KAAKiB,OAAOC,KAAKlB,MAjBrB,GAmBnBL,aAAawB,GACT,MAAO,KACH,IAAIlB,EAASD,KAAKC,OAAOkB,EAAOT,MAChCS,EAAOC,QAAUnB,EAAOoB,WACxBrB,KAAKD,MAAMuB,KAAK,SAAUH,IAGlCxB,OAAO4B,EAAGC,GACN,IAAIL,EAASI,EAAEZ,KACXV,EAASD,KAAKC,OAAOkB,EAAOT,MAC3BS,EAAOM,WACRxB,EAAOyB,SAASP,EAAOC,SACvBD,EAAOM,SAAWxB,EAClBA,EAAOe,GAAG,SAAUhB,KAAK2B,aAAaR,KAO9CS,0BACI,MAAO,OAGXC,uBACI,MAAO,cAMf,OAFAtC,EAAgBuC,SAASxC,GAElBC","file":"../../../addons/edit/codemirror.js","sourcesContent":["define([\n    'skylark-langx/langx',\n    'skylark-domx-data',\n    'skylark-codemirror/CodeMirror',\n    \"../../Addon\",\n    '../../util',\n    \"../../Coder\"    \n], function (langx,datax,CodeMirror,Addon,util,Coder) {\n    'use strict';\n    class AddonCodeMirror  extends Addon{\n        //constructor(coder, options) \n\n        get options() {\n            return {\n               lineNumbers: true,\n               pluginCssClass : \"coder-plugin-codemirror\"\n            }\n        }\n\n        _init() {\n            super._init();\n            var coder = this.coder,\n                options = this.options;\n\n            var priority = 1;\n            var i;\n            this.editor = {};\n            //this.coder = coder;\n            var modemap = { 'html': 'htmlmixed' };\n            var options = this.options;\n            //if (typeof window.CodeMirror === 'undefined') {\n            //    return;\n            //}\n            var $editors = coder.$container.querySelectorAll('.coder-editor');\n            for (i = 0; i < $editors.length; i++) {\n                let $textarea = $editors[i].querySelector('textarea');\n                let type = datax.data($textarea, 'coder-type');\n                let file = datax.data($textarea, 'coder-file');\n                this.editor[type] = CodeMirror.fromTextArea($textarea, options);\n                this.editor[type].setOption('mode', util.getMode(type, file, modemap));\n            }\n            coder.on('change', this.change.bind(this), priority);\n        }\n        editorChange(params) {\n            return () => {\n                var editor = this.editor[params.type];\n                params.content = editor.getValue();\n                this.coder.emit('change', params);\n            };\n        }\n        change(e, callback) {\n            var params = e.data,\n                editor = this.editor[params.type];\n            if (!params.cmEditor) {\n                editor.setValue(params.content);\n                params.cmEditor = editor;\n                editor.on('change', this.editorChange(params));\n            }\n            //params.content = editor.getValue();\n            //callback(null, params);\n        }\n\n\n        static get categoryName() {\n            return \"edit\";\n        }\n\n        static get addonName(){\n            return \"codemirror\";\n        }        \n    };\n\n    AddonCodeMirror.register(Coder);\n\n    return AddonCodeMirror;\n});"]}