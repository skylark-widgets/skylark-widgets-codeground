{"version":3,"sources":["addons/render.js"],"names":["define","util","Coder","PluginRender","[object Object]","coder","options","extend","supportSrcdoc","document","createElement","$resultFrame","$container","querySelector","window","addEventListener","this","domready","bind","on","change","content","html","css","js","frameContent","callbacks","index","lastCallback","style","body","script","params","callback","type","oldFrameContent","template","forceRender","$newResultFrame","parentNode","replaceChild","contentWindow","open","write","close","setAttribute","jsUrl","location","e","source","data","JSON","parse","plugin"],"mappings":";;;;;;;AAAAA,QACI,UACA,YACD,SAAUC,EAAKC,GACd,mBACMC,EACFC,YAAYC,EAAOC,GACfA,EAAUL,EAAKM,OAAOD,MACtB,IAAIE,KAAmB,WAAYC,SAASC,cAAc,WACtDC,EAAeN,EAAMO,WAAWC,cAAc,6BAOlDC,OAAOC,iBAAiB,UAAWC,KAAKC,SAASC,KAAKF,OACtDX,EAAMc,GAAG,SAAUH,KAAKI,OAAOF,KAAKF,MAAO,KAC3CA,KAAKR,cAAgBA,EACrBQ,KAAKK,SAPDC,KAAM,GACNC,IAAK,GACLC,GAAI,IAMRR,KAAKS,aAVc,GAWnBT,KAAKL,aAAeA,EACpBK,KAAKU,aACLV,KAAKW,MAAQ,EACbX,KAAKY,aAAe,SAGxBxB,SAASyB,EAAQ,GAAIC,EAAO,GAAIC,EAAS,IACrC,uYAcQF,yDAGPC,sMAOQC,oDAKb3B,OAAO4B,EAAQC,GACXjB,KAAKK,QAAQW,EAAOE,MAAQF,EAAOX,QACnC,IAAIc,EAAkBnB,KAAKS,aAO3B,GANAT,KAAKS,aAAeT,KAAKoB,SAASpB,KAAKK,QAAa,IAAGL,KAAKK,QAAc,KAAGL,KAAKK,QAAY,IAC9FL,KAAKY,aAAe,MAChBZ,KAAKY,aAAe,SAEpBK,EAAS,KAAMD,MAEQ,IAAvBA,EAAOK,aAAwBrB,KAAKS,eAAiBU,EAIzD,GAAInB,KAAKR,cAAe,CACpB,IAAI8B,EAAkB7B,SAASC,cAAc,UAC7CM,KAAKL,aAAa4B,WAAWC,aAAaF,EAAiBtB,KAAKL,cAChEK,KAAKL,aAAe2B,EACpBtB,KAAKL,aAAa8B,cAAchC,SAASiC,OACzC1B,KAAKL,aAAa8B,cAAchC,SAASkC,MAAM3B,KAAKS,cACpDT,KAAKL,aAAa8B,cAAchC,SAASmC,YACtC,CACH5B,KAAKL,aAAakC,aAAa,cAAe7B,KAAKS,cACnD,IAAIqB,EAAQ,8DACZ9B,KAAKL,aAAakC,aAAa,MAAOC,GAClC9B,KAAKL,aAAa8B,gBAClBzB,KAAKL,aAAa8B,cAAcM,SAAWD,QAf/Cb,EAAS,KAAMD,GAmBvB5B,SAAS4C,GACL,GAAIA,EAAEC,SAAWjC,KAAKL,aAAa8B,cAAnC,CAGA,IAAIS,KACJ,IACIA,EAAOC,KAAKC,MAAMJ,EAAEE,MACtB,MAAOF,IAES,oBAAdE,EAAKhB,MACLlB,KAAKY,iBAOjB,OAFA1B,EAAMmD,OAAO,SAAUlD,GAEhBA","file":"../../addons/render.js","sourcesContent":["define([\n    '../util',\n    \"../Coder\"\n], function (util,Coder) {\n    'use strict';\n    class PluginRender {\n        constructor(coder, options) {\n            options = util.extend(options, {});\n            var supportSrcdoc = !!('srcdoc' in document.createElement('iframe'));\n            var $resultFrame = coder.$container.querySelector('.coder-pane-result iframe');\n            var frameContent = '';\n            var content = {\n                html: '',\n                css: '',\n                js: ''\n            };\n            window.addEventListener('message', this.domready.bind(this));\n            coder.on('change', this.change.bind(this), 100);\n            this.supportSrcdoc = supportSrcdoc;\n            this.content = content;\n            this.frameContent = frameContent;\n            this.$resultFrame = $resultFrame;\n            this.callbacks = [];\n            this.index = 0;\n            this.lastCallback = () => {\n            };\n        }\n        template(style = '', body = '', script = '') {\n            return `\n      <!doctype html>\n      <html>\n        <head>\n          <script>\n            (function () {\n              window.addEventListener('DOMContentLoaded', function () {\n                window.parent.postMessage(JSON.stringify({\n                  type: 'coder-dom-ready'\n                }), '*')\n              })\n            }())\n          </script>\n\n          <style>${ style }</style>\n        </head>\n        <body>\n          ${ body }\n\n          <!--\n            Coder:\n            Empty script tag prevents malformed HTML from breaking the next script.\n          -->\n          <script></script>\n          <script>${ script }</script>\n        </body>\n      </html>\n    `;\n        }\n        change(params, callback) {\n            this.content[params.type] = params.content;\n            var oldFrameContent = this.frameContent;\n            this.frameContent = this.template(this.content['css'], this.content['html'], this.content['js']);\n            this.lastCallback = () => {\n                this.lastCallback = () => {\n                };\n                callback(null, params);\n            };\n            if (params.forceRender !== true && this.frameContent === oldFrameContent) {\n                callback(null, params);\n                return;\n            }\n            if (this.supportSrcdoc) {\n                var $newResultFrame = document.createElement('iframe');\n                this.$resultFrame.parentNode.replaceChild($newResultFrame, this.$resultFrame);\n                this.$resultFrame = $newResultFrame;\n                this.$resultFrame.contentWindow.document.open();\n                this.$resultFrame.contentWindow.document.write(this.frameContent);\n                this.$resultFrame.contentWindow.document.close();\n            } else {\n                this.$resultFrame.setAttribute('data-srcdoc', this.frameContent);\n                var jsUrl = 'javascript:window.frameElement.getAttribute(\"data-srcdoc\");';\n                this.$resultFrame.setAttribute('src', jsUrl);\n                if (this.$resultFrame.contentWindow) {\n                    this.$resultFrame.contentWindow.location = jsUrl;\n                }\n            }\n        }\n        domready(e) {\n            if (e.source !== this.$resultFrame.contentWindow) {\n                return;\n            }\n            var data = {};\n            try {\n                data = JSON.parse(e.data);\n            } catch (e) {\n            }\n            if (data.type === 'coder-dom-ready') {\n                this.lastCallback();\n            }\n        }\n    };\n\n    Coder.plugin('render', PluginRender);\n\n    return PluginRender;\n});"]}