{"version":3,"sources":["plugins/codemirror.js"],"names":["define","CodeMirror","util","[object Object]","coder","options","i","this","editor","modemap","html","extend","lineNumbers","$editors","$container","querySelectorAll","length","$textarea","querySelector","type","data","file","fromTextArea","setOption","getMode","on","change","bind","params","trigger","callback","cmEditor","setValue","content","editorChange","getValue"],"mappings":";;;;;;;AAAAA,QACI,gCACA,WACD,SAAUC,EAAWC,GACpB,aACA,aACIC,YAAYC,EAAOC,GACf,IACIC,EACJC,KAAKC,UACLD,KAAKH,MAAQA,EACb,IAAIK,GAAYC,KAAQ,aACxBL,EAAUH,EAAKS,OAAON,GAAWO,aAAa,IAI9C,IAAIC,EAAWT,EAAMU,WAAWC,iBAAiB,iBACjD,IAAKT,EAAI,EAAGA,EAAIO,EAASG,OAAQV,IAAK,CAClC,IAAIW,EAAYJ,EAASP,GAAGY,cAAc,YACtCC,EAAOjB,EAAKkB,KAAKH,EAAW,cAC5BI,EAAOnB,EAAKkB,KAAKH,EAAW,cAChCV,KAAKC,OAAOW,GAAQlB,EAAWqB,aAAaL,EAAWZ,GACvDE,KAAKC,OAAOW,GAAMI,UAAU,OAAQrB,EAAKsB,QAAQL,EAAME,EAAMZ,IAEjEL,EAAMqB,GAAG,SAAUlB,KAAKmB,OAAOC,KAAKpB,MAjBrB,GAmBnBJ,aAAayB,GACT,MAAO,KACHrB,KAAKH,MAAMyB,QAAQ,SAAUD,IAGrCzB,OAAOyB,EAAQE,GACX,IAAItB,EAASD,KAAKC,OAAOoB,EAAOT,MAC3BS,EAAOG,WACRvB,EAAOwB,SAASJ,EAAOK,SACvBL,EAAOG,SAAWvB,EAClBA,EAAOiB,GAAG,SAAUlB,KAAK2B,aAAaN,KAE1CA,EAAOK,QAAUzB,EAAO2B,WACxBL,EAAS,KAAMF","file":"../../plugins/codemirror.js","sourcesContent":["define([\n    'skylark-codemirror/CodeMirror',\n    '../util'\n], function (CodeMirror,util) {\n    'use strict';\n    return class PluginCodeMirror {\n        constructor(coder, options) {\n            var priority = 1;\n            var i;\n            this.editor = {};\n            this.coder = coder;\n            var modemap = { 'html': 'htmlmixed' };\n            options = util.extend(options, { lineNumbers: true });\n            //if (typeof window.CodeMirror === 'undefined') {\n            //    return;\n            //}\n            var $editors = coder.$container.querySelectorAll('.coder-editor');\n            for (i = 0; i < $editors.length; i++) {\n                let $textarea = $editors[i].querySelector('textarea');\n                let type = util.data($textarea, 'coder-type');\n                let file = util.data($textarea, 'coder-file');\n                this.editor[type] = CodeMirror.fromTextArea($textarea, options);\n                this.editor[type].setOption('mode', util.getMode(type, file, modemap));\n            }\n            coder.on('change', this.change.bind(this), priority);\n        }\n        editorChange(params) {\n            return () => {\n                this.coder.trigger('change', params);\n            };\n        }\n        change(params, callback) {\n            var editor = this.editor[params.type];\n            if (!params.cmEditor) {\n                editor.setValue(params.content);\n                params.cmEditor = editor;\n                editor.on('change', this.editorChange(params));\n            }\n            params.content = editor.getValue();\n            callback(null, params);\n        }\n    };\n});"]}