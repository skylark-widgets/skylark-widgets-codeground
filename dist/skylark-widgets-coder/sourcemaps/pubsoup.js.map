{"version":3,"sources":["pubsoup.js"],"names":["define","util","[object Object]","this","topics","callbacks","query","topic","subscriber","priority","foundTopic","find","_priority","push","sort","a","b","arr","fn","forEach","index","indexOf","call","splice","length","remover","params","runList","seq","runCallbacks","err","c","callback"],"mappings":";;;;;;;AAAAA,QAAQ,UAAW,SAAUC,GACzB,aACA,aACIC,cACIC,KAAKC,UACLD,KAAKE,aAETH,KAAKI,GAED,OADAH,KAAKC,OAAOE,GAASH,KAAKC,OAAOE,OAC1BH,KAAKC,OAAOE,GAEvBJ,UAAUK,EAAOC,EAAYC,EAAW,IACpC,IAAIC,EAAaP,KAAKQ,KAAKJ,GAC3BC,EAAWI,UAAYH,EACvBC,EAAWG,KAAKL,GAChBE,EAAWI,KAAK,SAAUC,EAAGC,GACzB,OAAOD,EAAEH,UAAYI,EAAEJ,UAAY,EAAII,EAAEJ,UAAYG,EAAEH,WAAa,EAAI,IAGhFV,QAAQe,EAAKC,GACTD,EAAIE,QAAQ,WACR,GAAKD,EAAL,CAIA,IAAIE,KAAWC,QAAQC,KAAKL,EAAKC,IAClB,IAAXE,GAGJH,EAAIM,OAAOH,EAAO,QAPdH,EAAIO,OAAS,IAUzBtB,YAAYK,EAAOC,GACf,IAAIE,EAAaP,KAAKQ,KAAKJ,GAC3BJ,KAAKsB,QAAQf,EAAYF,GACzBL,KAAKE,UAAUE,GAASJ,KAAKE,UAAUE,OACvCJ,KAAKsB,QAAQtB,KAAKE,UAAUE,GAAQC,GAExCN,QAAQK,EAAOmB,MACX,IACIC,KADaxB,KAAKQ,KAAKJ,GAEhBY,QAAQ,SAAUX,GACzBmB,EAAQd,KAAKL,KAEjBP,EAAK2B,IAAID,EAASD,EAAQvB,KAAK0B,aAAatB,IAEhDL,aAAaK,GACT,MAAO,CAACuB,EAAKJ,KACTvB,KAAKE,UAAUE,GAASJ,KAAKE,UAAUE,OACvCJ,KAAKE,UAAUE,GAAOY,QAAQY,IAC1BA,EAAED,EAAKJ,MAInBxB,KAAKK,EAAOyB,EAAW,cAEnB7B,KAAKE,UAAUE,GAASJ,KAAKE,UAAUE,OACvCJ,KAAKE,UAAUE,GAAOM,KAAKmB","file":"../pubsoup.js","sourcesContent":["define(['./util'], function (util) {\n    'use strict';\n    return class PubSoup {\n        constructor() {\n            this.topics = {};\n            this.callbacks = {};\n        }\n        find(query) {\n            this.topics[query] = this.topics[query] || [];\n            return this.topics[query];\n        }\n        subscribe(topic, subscriber, priority = 90) {\n            var foundTopic = this.find(topic);\n            subscriber._priority = priority;\n            foundTopic.push(subscriber);\n            foundTopic.sort(function (a, b) {\n                return a._priority > b._priority ? 1 : b._priority > a._priority ? -1 : 0;\n            });\n        }\n        remover(arr, fn) {\n            arr.forEach(function () {\n                if (!fn) {\n                    arr.length = 0;\n                    return;\n                }\n                var index = [].indexOf.call(arr, fn);\n                if (index === -1) {\n                    return;\n                }\n                arr.splice(index, 1);\n            });\n        }\n        unsubscribe(topic, subscriber) {\n            var foundTopic = this.find(topic);\n            this.remover(foundTopic, subscriber);\n            this.callbacks[topic] = this.callbacks[topic] || [];\n            this.remover(this.callbacks[topic], subscriber);\n        }\n        publish(topic, params = {}) {\n            var foundTopic = this.find(topic);\n            var runList = [];\n            foundTopic.forEach(function (subscriber) {\n                runList.push(subscriber);\n            });\n            util.seq(runList, params, this.runCallbacks(topic));\n        }\n        runCallbacks(topic) {\n            return (err, params) => {\n                this.callbacks[topic] = this.callbacks[topic] || [];\n                this.callbacks[topic].forEach(c => {\n                    c(err, params);\n                });\n            };\n        }\n        done(topic, callback = function () {\n        }) {\n            this.callbacks[topic] = this.callbacks[topic] || [];\n            this.callbacks[topic].push(callback);\n        }\n    };\n});"]}