/**
 * skylark-ui-coder - The skylark coder widget
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylarkui/skylark-ui-coder/
 * @license MIT
 */
define(["../CoderCtor"],function(e){e.partial({regChange:function(e,i,n){var r=this;null==e&&(e=r.doc.first),null==i&&(i=r.doc.first+r.doc.size),n||(n=0);var v=r.display;if(n&&i<v.viewTo&&(null==v.updateLineNumbers||v.updateLineNumbers>e)&&(v.updateLineNumbers=e),r.curOp.viewChanged=!0,e>=v.viewTo)sawCollapsedSpans&&r.visualLineNo(r.doc,e)<v.viewTo&&resetView(r);else if(i<=v.viewFrom)sawCollapsedSpans&&r.visualLineEndNo(r.doc,i+n)>v.viewFrom?resetView(r):(v.viewFrom+=n,v.viewTo+=n);else if(e<=v.viewFrom&&i>=v.viewTo)r.resetView();else if(e<=v.viewFrom){var w=r.viewCuttingPoint(i,i+n,1);w?(v.view=v.view.slice(w.index),v.viewFrom=w.lineN,v.viewTo+=n):resetView(r)}else if(i>=v.viewTo){var w=r.viewCuttingPoint(e,e,-1);w?(v.view=v.view.slice(0,w.index),v.viewTo=w.lineN):r.resetView()}else{var l=r.viewCuttingPoint(e,e,-1),s=r.viewCuttingPoint(i,i+n,1);l&&s?(v.view=v.view.slice(0,l.index).concat(r.buildViewArray(l.lineN,s.lineN)).concat(v.view.slice(s.index)),v.viewTo+=n):r.resetView()}var o=v.externalMeasured;o&&(i<o.lineN?o.lineN+=n:e<o.lineN+o.size&&(v.externalMeasured=null))},regLineChange:function(e,i){var n=this;n.curOp.viewChanged=!0;var r=n.display,v=n.display.externalMeasured;if(v&&e>=v.lineN&&e<v.lineN+v.size&&(r.externalMeasured=null),!(e<r.viewFrom||e>=r.viewTo)){var w=r.view[findViewIndex(n,e)];if(null!=w.node){var l=w.changes||(w.changes=[]);indexOf(l,i)==-1&&l.push(i)}}},resetView:function(){var e=this;e.display.viewFrom=e.display.viewTo=e.doc.first,e.display.view=[],e.display.viewOffset=0},findViewIndex:function(e){var i=this;if(e>=i.display.viewTo)return null;if(e-=i.display.viewFrom,e<0)return null;for(var n=i.display.view,r=0;r<n.length;r++)if(e-=n[r].size,e<0)return r},viewCuttingPoint:function(e,i,n){var r,v=this,w=v.findViewIndex(e),l=v.display.view;if(!sawCollapsedSpans||i==v.doc.first+v.doc.size)return{index:w,lineN:i};for(var s=0,o=v.display.viewFrom;s<w;s++)o+=l[s].size;if(o!=e){if(n>0){if(w==l.length-1)return null;r=o+l[w].size-e,w++}else r=o-e;e+=r,i+=r}for(;v.visualLineNo(v.doc,i)!=i;){if(w==(n<0?0:l.length-1))return null;i+=n*l[w-(n<0?1:0)].size,w+=n}return{index:w,lineN:i}},adjustView:function(e,i){var n=this,r=n.display,v=r.view;0==v.length||e>=r.viewTo||i<=r.viewFrom?(r.view=n.buildViewArray(e,i),r.viewFrom=e):(r.viewFrom>e?r.view=n.buildViewArray(e,r.viewFrom).concat(r.view):r.viewFrom<e&&(r.view=r.view.slice(n.findViewIndex(e))),r.viewFrom=e,r.viewTo<i?r.view=r.view.concat(n.buildViewArray(r.viewTo,i)):r.viewTo>i&&(r.view=r.view.slice(0,n.findViewIndex(i)))),r.viewTo=i},countDirtyView:function(){for(var e=this,i=e.display.view,n=0,r=0;r<i.length;r++){var v=i[r];v.hidden||v.node&&!v.changes||++n}return n}})});
//# sourceMappingURL=../../sourcemaps/primitives/display/view_tracking.js.map
