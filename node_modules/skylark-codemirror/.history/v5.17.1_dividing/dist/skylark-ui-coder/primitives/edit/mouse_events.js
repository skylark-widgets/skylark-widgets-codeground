/**
 * skylark-ui-coder - The skylark coder widget
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylarkui/skylark-ui-coder/
 * @license MIT
 */
define(["../CoderCtor"],function(e){var t,n;e.partial({onContextMenu:function(e){var t=this;t.display.eventInWidget(e)||t.contextMenuInGutter(e)||t.signalDOMEvent(e,"contextmenu")||t.display.input.onContextMenu(e)},contextMenuInGutter:function(e){var t=this;return!!t.hasHandler("gutterContextMenu")&&t.gutterEvent(e,"gutterContextMenu",!1)},onMouseDown:function(e){var t=this,n=t.display;if(!(t.signalDOMEvent(e)||n.activeTouch&&n.input.supportsTouch())){if(n.shift=e.shiftKey,n.eventInWidget(e))return void(webkit||(n.scroller.draggable=!1,setTimeout(function(){n.scroller.draggable=!0},100)));if(!t.clickInGutter(e)){var o=t.posFromMouse(e);switch(window.focus(),e_button(e)){case 1:t.state.selectingText?t.state.selectingText(e):o?t.leftButtonDown(e,o):e_target(e)==n.scroller&&e_preventDefault(e);break;case 2:webkit&&(t.state.lastMiddleDown=+new Date),o&&extendSelection(t.doc,o),setTimeout(function(){n.input.focus()},20),e_preventDefault(e);break;case 3:captureRightClick?t.onContextMenu(e):t.delayBlurEvent(t)}}}},leftButtonDown:function(e,o){var i=this;ie?setTimeout(bind(ensureFocus,i),0):i.curOp.focus=activeElt();var l,r=+new Date;n&&n.time>r-400&&0==cmp(n.pos,o)?l="triple":t&&t.time>r-400&&0==cmp(t.pos,o)?(l="double",n={time:r,pos:o}):(l="single",t={time:r,pos:o});var s,a=i.doc.sel,c=mac?e.metaKey:e.ctrlKey;i.options.dragDrop&&dragAndDrop&&!i.isReadOnly()&&"single"==l&&(s=a.contains(o))>-1&&(cmp((s=a.ranges[s]).from(),o)<0||o.xRel>0)&&(cmp(s.to(),o)>0||o.xRel<0)?i.leftButtonStartDrag(e,o,c):i.leftButtonSelect(e,o,l,c)},leftButtonStartDrag:function(e,t,n){var o=this,i=o.display,l=+new Date,r=o.operation(function(s){webkit&&(i.scroller.draggable=!1),o.state.draggingText=!1,off(document,"mouseup",r),off(i.scroller,"drop",r),Math.abs(e.clientX-s.clientX)+Math.abs(e.clientY-s.clientY)<10&&(e_preventDefault(s),!n&&+new Date-200<l&&o.extendSelection(o.doc,t),webkit||ie&&9==ie_version?setTimeout(function(){document.body.focus(),i.input.focus()},20):i.input.focus())});webkit&&(i.scroller.draggable=!0),o.state.draggingText=r,r.copy=mac?e.altKey:e.ctrlKey,i.scroller.dragDrop&&i.scroller.dragDrop(),on(document,"mouseup",r),on(i.scroller,"drop",r)},leftButtonSelect:function(e,t,n,o){function i(e){if(0!=cmp(h,e))if(h=e,"rect"==n){for(var o=[],i=s.options.tabSize,l=countColumn(getLine(c,t.line).text,t.ch,i),r=countColumn(getLine(c,e.line).text,e.ch,i),a=Math.min(l,r),d=Math.max(l,r),p=Math.min(t.line,e.line),m=Math.min(s.lastLine(),Math.max(t.line,e.line));p<=m;p++){var v=getLine(c,p).text,x=findColumn(v,a,i);a==d?o.push(new Range(Pos(p,x),Pos(p,x))):v.length>x&&o.push(new Range(Pos(p,x),Pos(p,findColumn(v,d,i))))}o.length||o.push(new Range(t,t)),setSelection(c,normalizeSelection(g.ranges.slice(0,f).concat(o),f),{origin:"*mouse",scroll:!1}),s.scrollIntoView(e)}else{var w=u,y=w.anchor,b=e;if("single"!=n){if("double"==n)var D=s.findWordAt(e);else var D=new Range(Pos(e.line,0),clipPos(c,Pos(e.line+1,0)));cmp(D.anchor,y)>0?(b=D.head,y=minPos(w.from(),D.anchor)):(b=D.anchor,y=maxPos(w.to(),D.head))}var o=g.ranges.slice(0);o[f]=new Range(clipPos(c,y),b),setSelection(c,normalizeSelection(o,f),sel_mouse)}}function l(e){var t=++x,o=s.posFromMouse(e,!0,"rect"==n);if(o)if(0!=cmp(o,h)){s.curOp.focus=activeElt(),i(o);var r=visibleLines(a,c);(o.line>=r.to||o.line<r.from)&&setTimeout(s.operation(function(){x==t&&l(e)}),150)}else{var u=e.clientY<v.top?-20:e.clientY>v.bottom?20:0;u&&setTimeout(s.operation(function(){x==t&&(a.scroller.scrollTop+=u,l(e))}),50)}}function r(e){s.state.selectingText=!1,x=1/0,e_preventDefault(e),a.input.focus(),off(document,"mousemove",w),off(document,"mouseup",y),c.history.lastSelOrigin=null}var s=this,a=s.display,c=s.doc;e_preventDefault(e);var u,f,g=c.sel,d=g.ranges;if(o&&!e.shiftKey?(f=c.sel.contains(t),u=f>-1?d[f]:new Range(t,t)):(u=c.sel.primary(),f=c.sel.primIndex),chromeOS?e.shiftKey&&e.metaKey:e.altKey)n="rect",o||(u=new Range(t,t)),t=s.posFromMouse(e,!0,!0),f=-1;else if("double"==n){var p=s.findWordAt(t);u=s.display.shift||c.extend?extendRange(c,u,p.anchor,p.head):p}else if("triple"==n){var m=new Range(Pos(t.line,0),clipPos(c,Pos(t.line+1,0)));u=s.display.shift||c.extend?extendRange(c,u,m.anchor,m.head):m}else u=extendRange(c,u,t);o?f==-1?(f=d.length,setSelection(c,normalizeSelection(d.concat([u]),f),{scroll:!1,origin:"*mouse"})):d.length>1&&d[f].empty()&&"single"==n&&!e.shiftKey?(setSelection(c,normalizeSelection(d.slice(0,f).concat(d.slice(f+1)),0),{scroll:!1,origin:"*mouse"}),g=c.sel):replaceOneSelection(c,f,u,sel_mouse):(f=0,setSelection(c,new Selection([u],0),sel_mouse),g=c.sel);var h=t,v=a.wrapper.getBoundingClientRect(),x=0,w=s.operation(function(e){e_button(e)?l(e):r(e)}),y=s.operation(r);s.state.selectingText=y,on(document,"mousemove",w),on(document,"mouseup",y)},gutterEvent:function(e,t,n){var o=this;try{var i=e.clientX,l=e.clientY}catch(e){return!1}if(i>=Math.floor(o.display.gutters.getBoundingClientRect().right))return!1;n&&e_preventDefault(e);var r=o.display,s=r.lineDiv.getBoundingClientRect();if(l>s.bottom||!hasHandler(t))return e_defaultPrevented(e);l-=s.top-r.viewOffset;for(var a=0;a<o.options.gutters.length;++a){var c=r.gutters.childNodes[a];if(c&&c.getBoundingClientRect().right>=i){var u=lineAtHeight(o.doc,l),f=o.options.gutters[a];return o.signal(t,o,u,f,e),e_defaultPrevented(e)}}},clickInGutter:function(e){var t=this;return t.gutterEvent(e,"gutterClick",!0)}})});
//# sourceMappingURL=../../sourcemaps/primitives/edit/mouse_events.js.map
