/**
 * skylark-ui-coder - The skylark coder widget
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylarkui/skylark-ui-coder/
 * @license MIT
 */
define(["skylark-langx/klass","../CoderCtor"],function(e){function t(e,t){if(!e||/^\s*$/.test(e))return null;var a=t.addModeClass?i:o;return a[e]||(a[e]=e.replace(/\S+/g,"cm-$&"))}function a(e,t,a,r,l,n,o){if(t){var i=e.splitSpaces?s(t,e.trailingSpace):t,p=e.cm.state.specialChars,c=!1;if(p.test(t))for(var d=document.createDocumentFragment(),m=0;;){p.lastIndex=m;var u=p.exec(t),f=u?u.index-m:t.length-m;if(f){var h=document.createTextNode(i.slice(m,m+f));ie&&ie_version<9?d.appendChild(elt("span",[h])):d.appendChild(h),e.map.push(e.pos,e.pos+f,h),e.col+=f,e.pos+=f}if(!u)break;if(m+=f+1,"\t"==u[0]){var C=e.cm.options.tabSize,g=C-e.col%C,h=d.appendChild(elt("span",spaceStr(g),"cm-tab"));h.setAttribute("role","presentation"),h.setAttribute("cm-text","\t"),e.col+=g}else if("\r"==u[0]||"\n"==u[0]){var h=d.appendChild(elt("span","\r"==u[0]?"␍":"␤","cm-invalidchar"));h.setAttribute("cm-text",u[0]),e.col+=1}else{var h=e.cm.options.specialCharPlaceholder(u[0]);h.setAttribute("cm-text",u[0]),ie&&ie_version<9?d.appendChild(elt("span",[h])):d.appendChild(h),e.col+=1}e.map.push(e.pos,e.pos+1,h),e.pos++}else{e.col+=t.length;var d=document.createTextNode(i);e.map.push(e.pos,e.pos+t.length,d),ie&&ie_version<9&&(c=!0),e.pos+=t.length}if(e.trailingSpace=32==i.charCodeAt(t.length-1),a||r||l||c||o){var v=a||"";r&&(v+=r),l&&(v+=l);var b=elt("span",[d],v,o);return n&&(b.title=n),e.content.appendChild(b)}e.content.appendChild(d)}}function s(e,t){if(e.length>1&&!/  /.test(e))return e;for(var a=t,s="",r=0;r<e.length;r++){var l=e.charAt(r);" "!=l||!a||r!=e.length-1&&32!=e.charCodeAt(r+1)||(l=" "),s+=l,a=" "==l}return s}function r(e,t){return function(a,s,r,l,n,o,i){r=r?r+" cm-force-border":"cm-force-border";for(var p=a.pos,c=p+s.length;;){for(var d=0;d<t.length;d++){var m=t[d];if(m.to>p&&m.from<=p)break}if(m.to>=c)return e(a,s,r,l,n,o,i);e(a,s.slice(0,m.to-p),r,l,null,o,i),l=null,s=s.slice(m.to-p),p=m.to}}}function l(e,t,a,s){var r=!s&&a.widgetNode;r&&e.map.push(e.pos,e.pos+t,r),!s&&e.cm.display.input.needsContentAttribute&&(r||(r=e.content.appendChild(document.createElement("span"))),r.setAttribute("cm-marker",a.id)),r&&(e.cm.display.input.setUneditable(r),e.content.appendChild(r)),e.pos+=t,e.trailingSpace=!1}function n(e,a,s){var r=e.markedSpans,n=e.text,o=0;if(r)for(var i,p,c,d,m,u,f,h=n.length,C=0,g=1,v="",b=0;;){if(b==C){c=d=m=u=p="",f=null,b=1/0;for(var k,y=[],x=0;x<r.length;++x){var S=r[x],N=S.marker;"bookmark"==N.type&&S.from==C&&N.widgetNode?y.push(N):S.from<=C&&(null==S.to||S.to>C||N.collapsed&&S.to==C&&S.from==C)?(null!=S.to&&S.to!=C&&b>S.to&&(b=S.to,d=""),N.className&&(c+=" "+N.className),N.css&&(p=(p?p+";":"")+N.css),N.startStyle&&S.from==C&&(m+=" "+N.startStyle),N.endStyle&&S.to==b&&(k||(k=[])).push(N.endStyle,S.to),N.title&&!u&&(u=N.title),N.collapsed&&(!f||compareCollapsedMarkers(f.marker,N)<0)&&(f=S)):S.from>C&&b>S.from&&(b=S.from)}if(k)for(var x=0;x<k.length;x+=2)k[x+1]==b&&(d+=" "+k[x]);if(!f||f.from==C)for(var x=0;x<y.length;++x)l(a,0,y[x]);if(f&&(f.from||0)==C){if(l(a,(null==f.to?h+1:f.to)-C,f.marker,null==f.from),null==f.to)return;f.to==C&&(f=!1)}}if(C>=h)break;for(var A=Math.min(h,b);;){if(v){var w=C+v.length;if(!f){var T=w>A?v.slice(0,A-C):v;a.addToken(a,T,i?i+c:c,m,C+T.length==b?d:"",u,p)}if(w>=A){v=v.slice(A-C),C=A;break}C=w,m=""}v=n.slice(o,o=s[g++]),i=t(s[g++],a.cm.options)}}else for(var g=1;g<s.length;g+=2)a.addToken(a,n.slice(o,o=s[g]),t(s[g+1],a.cm.options))}e.partial({buildViewArray:function(e,t){for(var a,s=this,r=[],l=e;l<t;l=a){var n=new LineView(s.doc,getLine(s.doc,l),l);a=l+n.size,r.push(n)}return r},buildLineContent:function(e,t){var s=elt("span",null,null,webkit?"padding-right: .1px":null),l={pre:elt("pre",[s],"CodeMirror-line"),content:s,col:0,pos:0,cm:e,trailingSpace:!1,splitSpaces:(ie||webkit)&&e.getOption("lineWrapping")};t.measure={};for(var o=0;o<=(t.rest?t.rest.length:0);o++){var i,p=o?t.rest[o-1]:t.line;l.pos=0,l.addToken=a,hasBadBidiRects(e.display.measure)&&(i=getOrder(p))&&(l.addToken=r(l.addToken,i)),l.map=[];var c=t!=e.display.externalMeasured&&lineNo(p);n(p,l,e.getLineStyles(p,c)),p.styleClasses&&(p.styleClasses.bgClass&&(l.bgClass=joinClasses(p.styleClasses.bgClass,l.bgClass||"")),p.styleClasses.textClass&&(l.textClass=joinClasses(p.styleClasses.textClass,l.textClass||""))),0==l.map.length&&l.map.push(0,0,l.content.appendChild(zeroWidthElement(e.display.measure))),0==o?(t.measure.map=l.map,t.measure.cache={}):((t.measure.maps||(t.measure.maps=[])).push(l.map),(t.measure.caches||(t.measure.caches=[])).push({}))}if(webkit){var d=l.content.lastChild;(/\bcm-tab\b/.test(d.className)||d.querySeleCoderCtor&&d.querySeleCoderCtor(".cm-tab"))&&(l.content.className="cm-tab-wrap-hack")}return signal(e,"renderLine",e,t.line,l.pre),l.pre.className&&(l.textClass=joinClasses(l.pre.className,l.textClass||"")),l}});var o={},i={}});
//# sourceMappingURL=../../sourcemaps/primitives/line/line_data.js.map
