{"version":3,"sources":["addon/tern/tern.js"],"names":["define","CodeMirror","getFile","ts","name","c","buf","docs","docValue","options","findDoc","doc","n","cur","i","addDoc","resolveDoc","id","getDoc","Doc","trackChange","change","data","argHints","cachedArgHints","cmpPos","start","to","changed","from","line","end","text","length","lineCount","bigDoc","setTimeout","sendDoc","server","request","files","type","error","window","console","hint","cm","types","urls","showError","completions","after","getRange","Pos","ch","completion","className","typeToIcon","guess","cls","push","displayText","displayName","obj","list","tooltip","on","remove","node","content","completionTip","makeTooltip","parentNode","getBoundingClientRect","right","pageXOffset","top","pageYOffset","suffix","test","showContextInfo","pos","queryName","typeTip","tip","elt","appendChild","document","createTextNode","url","child","href","target","tempTooltip","updateArgHints","closeArgHints","somethingSelected","state","getTokenAt","getCursor","inner","innerMode","getMode","mode","lex","lexical","info","argPos","tabSize","getOption","e","Math","max","found","str","getLine","extra","tab","indexOf","column","charAt","cache","showArgHints","preferFunction","parseFnType","exprName","tp","args","arg","rettype","place","cursorCoords","activeArgHints","bottom","skipMatching","upto","depth","next","slice","match","jumpToDef","varName","req","variable","buildRequest","file","open","localDoc","findContext","jumpStack","moveTo","atInterestingExpression","dialog","jumpBack","pop","curDoc","setSelection","switchToDoc","before","context","contextOffset","split","startLine","nearest","cursor","getSearchCursor","nearestDist","Infinity","findNext","dist","abs","tok","rename","token","string","newName","fullDocs","applyChanges","changes","selectName","ranges","curPos","refs","ref","anchor","head","setSelections","perFile","Object","create","known","chs","sort","a","b","origin","nextChangeOrig","replaceRange","query","offsetLines","allowFragments","lineCharPositions","startPos","getFragmentAround","endLine","minIndent","minLine","p","min","fn","search","indent","countColumn","lastLine","tagname","createElement","arguments","f","openDialog","prompt","maybeClear","old","mouseOnTip","clear","ternTooltip","off","fadeOut","where","contains","relatedTarget","toElement","hintDelay","x","y","style","left","body","removeChild","opacity","msg","String","val","getValue","fileFilter","WorkerServer","send","msgId","pending","worker","postMessage","Worker","workerScript","defs","plugins","scripts","workerDeps","onmessage","err","log","message","onerror","this","addFile","delFile","TernServer","self","doc_comment","useWorker","tern","Server","async","getHint","prototype","delDoc","hideDoc","complete","showHint","showType","showDocs","extraOptions","queryOptions","prop","responseFilter","destroy","terminate"],"mappings":"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","file":"../../../addon/tern/tern.js","sourcesContent":["// CodeMirror, copyright (c) by Marijn Haverbeke and others\n// Distributed under an MIT license: http://codemirror.net/LICENSE\n\n// Glue code between CodeMirror and Tern.\n//\n// Create a CodeMirror.TernServer to wrap an actual Tern server,\n// register open documents (CodeMirror.Doc instances) with it, and\n// call its methods to activate the assisting functions that Tern\n// provides.\n//\n// Options supported (all optional):\n// * defs: An array of JSON definition data structures.\n// * plugins: An object mapping plugin names to configuration\n//   options.\n// * getFile: A function(name, c) that can be used to access files in\n//   the project that haven't been loaded yet. Simply do c(null) to\n//   indicate that a file is not available.\n// * fileFilter: A function(value, docName, doc) that will be applied\n//   to documents before passing them on to Tern.\n// * switchToDoc: A function(name, doc) that should, when providing a\n//   multi-file view, switch the view or focus to the named file.\n// * showError: A function(editor, message) that can be used to\n//   override the way errors are displayed.\n// * completionTip: Customize the content in tooltips for completions.\n//   Is passed a single argument—the completion's data as returned by\n//   Tern—and may return a string, DOM node, or null to indicate that\n//   no tip should be shown. By default the docstring is shown.\n// * typeTip: Like completionTip, but for the tooltips shown for type\n//   queries.\n// * responseFilter: A function(doc, query, request, error, data) that\n//   will be applied to the Tern responses before treating them\n//\n//\n// It is possible to run the Tern server in a web worker by specifying\n// these additional options:\n// * useWorker: Set to true to enable web worker mode. You'll probably\n//   want to feature detect the actual value you use here, for example\n//   !!window.Worker.\n// * workerScript: The main script of the worker. Point this to\n//   wherever you are hosting worker.js from this directory.\n// * workerDeps: An array of paths pointing (relative to workerScript)\n//   to the Acorn and Tern libraries and any Tern plugins you want to\n//   load. Or, if you minified those into a single script and included\n//   them in the workerScript, simply leave this undefined.\n\ndefine([\"../../Coder\"], function(CodeMirror) {\n  \"use strict\";\n  // declare global: tern\n\n  CodeMirror.TernServer = function(options) {\n    var self = this;\n    this.options = options || {};\n    var plugins = this.options.plugins || (this.options.plugins = {});\n    if (!plugins.doc_comment) plugins.doc_comment = true;\n    this.docs = Object.create(null);\n    if (this.options.useWorker) {\n      this.server = new WorkerServer(this);\n    } else {\n      this.server = new tern.Server({\n        getFile: function(name, c) { return getFile(self, name, c); },\n        async: true,\n        defs: this.options.defs || [],\n        plugins: plugins\n      });\n    }\n    this.trackChange = function(doc, change) { trackChange(self, doc, change); };\n\n    this.cachedArgHints = null;\n    this.activeArgHints = null;\n    this.jumpStack = [];\n\n    this.getHint = function(cm, c) { return hint(self, cm, c); };\n    this.getHint.async = true;\n  };\n\n  CodeMirror.TernServer.prototype = {\n    addDoc: function(name, doc) {\n      var data = {doc: doc, name: name, changed: null};\n      this.server.addFile(name, docValue(this, data));\n      CodeMirror.on(doc, \"change\", this.trackChange);\n      return this.docs[name] = data;\n    },\n\n    delDoc: function(id) {\n      var found = resolveDoc(this, id);\n      if (!found) return;\n      CodeMirror.off(found.doc, \"change\", this.trackChange);\n      delete this.docs[found.name];\n      this.server.delFile(found.name);\n    },\n\n    hideDoc: function(id) {\n      closeArgHints(this);\n      var found = resolveDoc(this, id);\n      if (found && found.changed) sendDoc(this, found);\n    },\n\n    complete: function(cm) {\n      cm.showHint({hint: this.getHint});\n    },\n\n    showType: function(cm, pos, c) { showContextInfo(this, cm, pos, \"type\", c); },\n\n    showDocs: function(cm, pos, c) { showContextInfo(this, cm, pos, \"documentation\", c); },\n\n    updateArgHints: function(cm) { updateArgHints(this, cm); },\n\n    jumpToDef: function(cm) { jumpToDef(this, cm); },\n\n    jumpBack: function(cm) { jumpBack(this, cm); },\n\n    rename: function(cm) { rename(this, cm); },\n\n    selectName: function(cm) { selectName(this, cm); },\n\n    request: function (cm, query, c, pos) {\n      var self = this;\n      var doc = findDoc(this, cm.getDoc());\n      var request = buildRequest(this, doc, query, pos);\n      var extraOptions = request.query && this.options.queryOptions && this.options.queryOptions[request.query.type]\n      if (extraOptions) for (var prop in extraOptions) request.query[prop] = extraOptions[prop];\n\n      this.server.request(request, function (error, data) {\n        if (!error && self.options.responseFilter)\n          data = self.options.responseFilter(doc, query, request, error, data);\n        c(error, data);\n      });\n    },\n\n    destroy: function () {\n      closeArgHints(this)\n      if (this.worker) {\n        this.worker.terminate();\n        this.worker = null;\n      }\n    }\n  };\n\n  var Pos = CodeMirror.Pos;\n  var cls = \"CodeMirror-Tern-\";\n  var bigDoc = 250;\n\n  function getFile(ts, name, c) {\n    var buf = ts.docs[name];\n    if (buf)\n      c(docValue(ts, buf));\n    else if (ts.options.getFile)\n      ts.options.getFile(name, c);\n    else\n      c(null);\n  }\n\n  function findDoc(ts, doc, name) {\n    for (var n in ts.docs) {\n      var cur = ts.docs[n];\n      if (cur.doc == doc) return cur;\n    }\n    if (!name) for (var i = 0;; ++i) {\n      n = \"[doc\" + (i || \"\") + \"]\";\n      if (!ts.docs[n]) { name = n; break; }\n    }\n    return ts.addDoc(name, doc);\n  }\n\n  function resolveDoc(ts, id) {\n    if (typeof id == \"string\") return ts.docs[id];\n    if (id instanceof CodeMirror) id = id.getDoc();\n    if (id instanceof CodeMirror.Doc) return findDoc(ts, id);\n  }\n\n  function trackChange(ts, doc, change) {\n    var data = findDoc(ts, doc);\n\n    var argHints = ts.cachedArgHints;\n    if (argHints && argHints.doc == doc && cmpPos(argHints.start, change.to) >= 0)\n      ts.cachedArgHints = null;\n\n    var changed = data.changed;\n    if (changed == null)\n      data.changed = changed = {from: change.from.line, to: change.from.line};\n    var end = change.from.line + (change.text.length - 1);\n    if (change.from.line < changed.to) changed.to = changed.to - (change.to.line - end);\n    if (end >= changed.to) changed.to = end + 1;\n    if (changed.from > change.from.line) changed.from = change.from.line;\n\n    if (doc.lineCount() > bigDoc && change.to - changed.from > 100) setTimeout(function() {\n      if (data.changed && data.changed.to - data.changed.from > 100) sendDoc(ts, data);\n    }, 200);\n  }\n\n  function sendDoc(ts, doc) {\n    ts.server.request({files: [{type: \"full\", name: doc.name, text: docValue(ts, doc)}]}, function(error) {\n      if (error) window.console.error(error);\n      else doc.changed = null;\n    });\n  }\n\n  // Completion\n\n  function hint(ts, cm, c) {\n    ts.request(cm, {type: \"completions\", types: true, docs: true, urls: true}, function(error, data) {\n      if (error) return showError(ts, cm, error);\n      var completions = [], after = \"\";\n      var from = data.start, to = data.end;\n      if (cm.getRange(Pos(from.line, from.ch - 2), from) == \"[\\\"\" &&\n          cm.getRange(to, Pos(to.line, to.ch + 2)) != \"\\\"]\")\n        after = \"\\\"]\";\n\n      for (var i = 0; i < data.completions.length; ++i) {\n        var completion = data.completions[i], className = typeToIcon(completion.type);\n        if (data.guess) className += \" \" + cls + \"guess\";\n        completions.push({text: completion.name + after,\n                          displayText: completion.displayName || completion.name,\n                          className: className,\n                          data: completion});\n      }\n\n      var obj = {from: from, to: to, list: completions};\n      var tooltip = null;\n      CodeMirror.on(obj, \"close\", function() { remove(tooltip); });\n      CodeMirror.on(obj, \"update\", function() { remove(tooltip); });\n      CodeMirror.on(obj, \"select\", function(cur, node) {\n        remove(tooltip);\n        var content = ts.options.completionTip ? ts.options.completionTip(cur.data) : cur.data.doc;\n        if (content) {\n          tooltip = makeTooltip(node.parentNode.getBoundingClientRect().right + window.pageXOffset,\n                                node.getBoundingClientRect().top + window.pageYOffset, content);\n          tooltip.className += \" \" + cls + \"hint-doc\";\n        }\n      });\n      c(obj);\n    });\n  }\n\n  function typeToIcon(type) {\n    var suffix;\n    if (type == \"?\") suffix = \"unknown\";\n    else if (type == \"number\" || type == \"string\" || type == \"bool\") suffix = type;\n    else if (/^fn\\(/.test(type)) suffix = \"fn\";\n    else if (/^\\[/.test(type)) suffix = \"array\";\n    else suffix = \"object\";\n    return cls + \"completion \" + cls + \"completion-\" + suffix;\n  }\n\n  // Type queries\n\n  function showContextInfo(ts, cm, pos, queryName, c) {\n    ts.request(cm, queryName, function(error, data) {\n      if (error) return showError(ts, cm, error);\n      if (ts.options.typeTip) {\n        var tip = ts.options.typeTip(data);\n      } else {\n        var tip = elt(\"span\", null, elt(\"strong\", null, data.type || \"not found\"));\n        if (data.doc)\n          tip.appendChild(document.createTextNode(\" — \" + data.doc));\n        if (data.url) {\n          tip.appendChild(document.createTextNode(\" \"));\n          var child = tip.appendChild(elt(\"a\", null, \"[docs]\"));\n          child.href = data.url;\n          child.target = \"_blank\";\n        }\n      }\n      tempTooltip(cm, tip, ts);\n      if (c) c();\n    }, pos);\n  }\n\n  // Maintaining argument hints\n\n  function updateArgHints(ts, cm) {\n    closeArgHints(ts);\n\n    if (cm.somethingSelected()) return;\n    var state = cm.getTokenAt(cm.getCursor()).state;\n    var inner = CodeMirror.innerMode(cm.getMode(), state);\n    if (inner.mode.name != \"javascript\") return;\n    var lex = inner.state.lexical;\n    if (lex.info != \"call\") return;\n\n    var ch, argPos = lex.pos || 0, tabSize = cm.getOption(\"tabSize\");\n    for (var line = cm.getCursor().line, e = Math.max(0, line - 9), found = false; line >= e; --line) {\n      var str = cm.getLine(line), extra = 0;\n      for (var pos = 0;;) {\n        var tab = str.indexOf(\"\\t\", pos);\n        if (tab == -1) break;\n        extra += tabSize - (tab + extra) % tabSize - 1;\n        pos = tab + 1;\n      }\n      ch = lex.column - extra;\n      if (str.charAt(ch) == \"(\") {found = true; break;}\n    }\n    if (!found) return;\n\n    var start = Pos(line, ch);\n    var cache = ts.cachedArgHints;\n    if (cache && cache.doc == cm.getDoc() && cmpPos(start, cache.start) == 0)\n      return showArgHints(ts, cm, argPos);\n\n    ts.request(cm, {type: \"type\", preferFunction: true, end: start}, function(error, data) {\n      if (error || !data.type || !(/^fn\\(/).test(data.type)) return;\n      ts.cachedArgHints = {\n        start: start,\n        type: parseFnType(data.type),\n        name: data.exprName || data.name || \"fn\",\n        guess: data.guess,\n        doc: cm.getDoc()\n      };\n      showArgHints(ts, cm, argPos);\n    });\n  }\n\n  function showArgHints(ts, cm, pos) {\n    closeArgHints(ts);\n\n    var cache = ts.cachedArgHints, tp = cache.type;\n    var tip = elt(\"span\", cache.guess ? cls + \"fhint-guess\" : null,\n                  elt(\"span\", cls + \"fname\", cache.name), \"(\");\n    for (var i = 0; i < tp.args.length; ++i) {\n      if (i) tip.appendChild(document.createTextNode(\", \"));\n      var arg = tp.args[i];\n      tip.appendChild(elt(\"span\", cls + \"farg\" + (i == pos ? \" \" + cls + \"farg-current\" : \"\"), arg.name || \"?\"));\n      if (arg.type != \"?\") {\n        tip.appendChild(document.createTextNode(\":\\u00a0\"));\n        tip.appendChild(elt(\"span\", cls + \"type\", arg.type));\n      }\n    }\n    tip.appendChild(document.createTextNode(tp.rettype ? \") ->\\u00a0\" : \")\"));\n    if (tp.rettype) tip.appendChild(elt(\"span\", cls + \"type\", tp.rettype));\n    var place = cm.cursorCoords(null, \"page\");\n    ts.activeArgHints = makeTooltip(place.right + 1, place.bottom, tip);\n  }\n\n  function parseFnType(text) {\n    var args = [], pos = 3;\n\n    function skipMatching(upto) {\n      var depth = 0, start = pos;\n      for (;;) {\n        var next = text.charAt(pos);\n        if (upto.test(next) && !depth) return text.slice(start, pos);\n        if (/[{\\[\\(]/.test(next)) ++depth;\n        else if (/[}\\]\\)]/.test(next)) --depth;\n        ++pos;\n      }\n    }\n\n    // Parse arguments\n    if (text.charAt(pos) != \")\") for (;;) {\n      var name = text.slice(pos).match(/^([^, \\(\\[\\{]+): /);\n      if (name) {\n        pos += name[0].length;\n        name = name[1];\n      }\n      args.push({name: name, type: skipMatching(/[\\),]/)});\n      if (text.charAt(pos) == \")\") break;\n      pos += 2;\n    }\n\n    var rettype = text.slice(pos).match(/^\\) -> (.*)$/);\n\n    return {args: args, rettype: rettype && rettype[1]};\n  }\n\n  // Moving to the definition of something\n\n  function jumpToDef(ts, cm) {\n    function inner(varName) {\n      var req = {type: \"definition\", variable: varName || null};\n      var doc = findDoc(ts, cm.getDoc());\n      ts.server.request(buildRequest(ts, doc, req), function(error, data) {\n        if (error) return showError(ts, cm, error);\n        if (!data.file && data.url) { window.open(data.url); return; }\n\n        if (data.file) {\n          var localDoc = ts.docs[data.file], found;\n          if (localDoc && (found = findContext(localDoc.doc, data))) {\n            ts.jumpStack.push({file: doc.name,\n                               start: cm.getCursor(\"from\"),\n                               end: cm.getCursor(\"to\")});\n            moveTo(ts, doc, localDoc, found.start, found.end);\n            return;\n          }\n        }\n        showError(ts, cm, \"Could not find a definition.\");\n      });\n    }\n\n    if (!atInterestingExpression(cm))\n      dialog(cm, \"Jump to variable\", function(name) { if (name) inner(name); });\n    else\n      inner();\n  }\n\n  function jumpBack(ts, cm) {\n    var pos = ts.jumpStack.pop(), doc = pos && ts.docs[pos.file];\n    if (!doc) return;\n    moveTo(ts, findDoc(ts, cm.getDoc()), doc, pos.start, pos.end);\n  }\n\n  function moveTo(ts, curDoc, doc, start, end) {\n    doc.doc.setSelection(start, end);\n    if (curDoc != doc && ts.options.switchToDoc) {\n      closeArgHints(ts);\n      ts.options.switchToDoc(doc.name, doc.doc);\n    }\n  }\n\n  // The {line,ch} representation of positions makes this rather awkward.\n  function findContext(doc, data) {\n    var before = data.context.slice(0, data.contextOffset).split(\"\\n\");\n    var startLine = data.start.line - (before.length - 1);\n    var start = Pos(startLine, (before.length == 1 ? data.start.ch : doc.getLine(startLine).length) - before[0].length);\n\n    var text = doc.getLine(startLine).slice(start.ch);\n    for (var cur = startLine + 1; cur < doc.lineCount() && text.length < data.context.length; ++cur)\n      text += \"\\n\" + doc.getLine(cur);\n    if (text.slice(0, data.context.length) == data.context) return data;\n\n    var cursor = doc.getSearchCursor(data.context, 0, false);\n    var nearest, nearestDist = Infinity;\n    while (cursor.findNext()) {\n      var from = cursor.from(), dist = Math.abs(from.line - start.line) * 10000;\n      if (!dist) dist = Math.abs(from.ch - start.ch);\n      if (dist < nearestDist) { nearest = from; nearestDist = dist; }\n    }\n    if (!nearest) return null;\n\n    if (before.length == 1)\n      nearest.ch += before[0].length;\n    else\n      nearest = Pos(nearest.line + (before.length - 1), before[before.length - 1].length);\n    if (data.start.line == data.end.line)\n      var end = Pos(nearest.line, nearest.ch + (data.end.ch - data.start.ch));\n    else\n      var end = Pos(nearest.line + (data.end.line - data.start.line), data.end.ch);\n    return {start: nearest, end: end};\n  }\n\n  function atInterestingExpression(cm) {\n    var pos = cm.getCursor(\"end\"), tok = cm.getTokenAt(pos);\n    if (tok.start < pos.ch && tok.type == \"comment\") return false;\n    return /[\\w)\\]]/.test(cm.getLine(pos.line).slice(Math.max(pos.ch - 1, 0), pos.ch + 1));\n  }\n\n  // Variable renaming\n\n  function rename(ts, cm) {\n    var token = cm.getTokenAt(cm.getCursor());\n    if (!/\\w/.test(token.string)) return showError(ts, cm, \"Not at a variable\");\n    dialog(cm, \"New name for \" + token.string, function(newName) {\n      ts.request(cm, {type: \"rename\", newName: newName, fullDocs: true}, function(error, data) {\n        if (error) return showError(ts, cm, error);\n        applyChanges(ts, data.changes);\n      });\n    });\n  }\n\n  function selectName(ts, cm) {\n    var name = findDoc(ts, cm.doc).name;\n    ts.request(cm, {type: \"refs\"}, function(error, data) {\n      if (error) return showError(ts, cm, error);\n      var ranges = [], cur = 0;\n      var curPos = cm.getCursor();\n      for (var i = 0; i < data.refs.length; i++) {\n        var ref = data.refs[i];\n        if (ref.file == name) {\n          ranges.push({anchor: ref.start, head: ref.end});\n          if (cmpPos(curPos, ref.start) >= 0 && cmpPos(curPos, ref.end) <= 0)\n            cur = ranges.length - 1;\n        }\n      }\n      cm.setSelections(ranges, cur);\n    });\n  }\n\n  var nextChangeOrig = 0;\n  function applyChanges(ts, changes) {\n    var perFile = Object.create(null);\n    for (var i = 0; i < changes.length; ++i) {\n      var ch = changes[i];\n      (perFile[ch.file] || (perFile[ch.file] = [])).push(ch);\n    }\n    for (var file in perFile) {\n      var known = ts.docs[file], chs = perFile[file];;\n      if (!known) continue;\n      chs.sort(function(a, b) { return cmpPos(b.start, a.start); });\n      var origin = \"*rename\" + (++nextChangeOrig);\n      for (var i = 0; i < chs.length; ++i) {\n        var ch = chs[i];\n        known.doc.replaceRange(ch.text, ch.start, ch.end, origin);\n      }\n    }\n  }\n\n  // Generic request-building helper\n\n  function buildRequest(ts, doc, query, pos) {\n    var files = [], offsetLines = 0, allowFragments = !query.fullDocs;\n    if (!allowFragments) delete query.fullDocs;\n    if (typeof query == \"string\") query = {type: query};\n    query.lineCharPositions = true;\n    if (query.end == null) {\n      query.end = pos || doc.doc.getCursor(\"end\");\n      if (doc.doc.somethingSelected())\n        query.start = doc.doc.getCursor(\"start\");\n    }\n    var startPos = query.start || query.end;\n\n    if (doc.changed) {\n      if (doc.doc.lineCount() > bigDoc && allowFragments !== false &&\n          doc.changed.to - doc.changed.from < 100 &&\n          doc.changed.from <= startPos.line && doc.changed.to > query.end.line) {\n        files.push(getFragmentAround(doc, startPos, query.end));\n        query.file = \"#0\";\n        var offsetLines = files[0].offsetLines;\n        if (query.start != null) query.start = Pos(query.start.line - -offsetLines, query.start.ch);\n        query.end = Pos(query.end.line - offsetLines, query.end.ch);\n      } else {\n        files.push({type: \"full\",\n                    name: doc.name,\n                    text: docValue(ts, doc)});\n        query.file = doc.name;\n        doc.changed = null;\n      }\n    } else {\n      query.file = doc.name;\n    }\n    for (var name in ts.docs) {\n      var cur = ts.docs[name];\n      if (cur.changed && cur != doc) {\n        files.push({type: \"full\", name: cur.name, text: docValue(ts, cur)});\n        cur.changed = null;\n      }\n    }\n\n    return {query: query, files: files};\n  }\n\n  function getFragmentAround(data, start, end) {\n    var doc = data.doc;\n    var minIndent = null, minLine = null, endLine, tabSize = 4;\n    for (var p = start.line - 1, min = Math.max(0, p - 50); p >= min; --p) {\n      var line = doc.getLine(p), fn = line.search(/\\bfunction\\b/);\n      if (fn < 0) continue;\n      var indent = CodeMirror.countColumn(line, null, tabSize);\n      if (minIndent != null && minIndent <= indent) continue;\n      minIndent = indent;\n      minLine = p;\n    }\n    if (minLine == null) minLine = min;\n    var max = Math.min(doc.lastLine(), end.line + 20);\n    if (minIndent == null || minIndent == CodeMirror.countColumn(doc.getLine(start.line), null, tabSize))\n      endLine = max;\n    else for (endLine = end.line + 1; endLine < max; ++endLine) {\n      var indent = CodeMirror.countColumn(doc.getLine(endLine), null, tabSize);\n      if (indent <= minIndent) break;\n    }\n    var from = Pos(minLine, 0);\n\n    return {type: \"part\",\n            name: data.name,\n            offsetLines: from.line,\n            text: doc.getRange(from, Pos(endLine, 0))};\n  }\n\n  // Generic utilities\n\n  var cmpPos = CodeMirror.cmpPos;\n\n  function elt(tagname, cls /*, ... elts*/) {\n    var e = document.createElement(tagname);\n    if (cls) e.className = cls;\n    for (var i = 2; i < arguments.length; ++i) {\n      var elt = arguments[i];\n      if (typeof elt == \"string\") elt = document.createTextNode(elt);\n      e.appendChild(elt);\n    }\n    return e;\n  }\n\n  function dialog(cm, text, f) {\n    if (cm.openDialog)\n      cm.openDialog(text + \": <input type=text>\", f);\n    else\n      f(prompt(text, \"\"));\n  }\n\n  // Tooltips\n\n  function tempTooltip(cm, content, ts) {\n    if (cm.state.ternTooltip) remove(cm.state.ternTooltip);\n    var where = cm.cursorCoords();\n    var tip = cm.state.ternTooltip = makeTooltip(where.right + 1, where.bottom, content);\n    function maybeClear() {\n      old = true;\n      if (!mouseOnTip) clear();\n    }\n    function clear() {\n      cm.state.ternTooltip = null;\n      if (!tip.parentNode) return;\n      cm.off(\"cursorActivity\", clear);\n      cm.off('blur', clear);\n      cm.off('scroll', clear);\n      fadeOut(tip);\n    }\n    var mouseOnTip = false, old = false;\n    CodeMirror.on(tip, \"mousemove\", function() { mouseOnTip = true; });\n    CodeMirror.on(tip, \"mouseout\", function(e) {\n      if (!CodeMirror.contains(tip, e.relatedTarget || e.toElement)) {\n        if (old) clear();\n        else mouseOnTip = false;\n      }\n    });\n    setTimeout(maybeClear, ts.options.hintDelay ? ts.options.hintDelay : 1700);\n    cm.on(\"cursorActivity\", clear);\n    cm.on('blur', clear);\n    cm.on('scroll', clear);\n  }\n\n  function makeTooltip(x, y, content) {\n    var node = elt(\"div\", cls + \"tooltip\", content);\n    node.style.left = x + \"px\";\n    node.style.top = y + \"px\";\n    document.body.appendChild(node);\n    return node;\n  }\n\n  function remove(node) {\n    var p = node && node.parentNode;\n    if (p) p.removeChild(node);\n  }\n\n  function fadeOut(tooltip) {\n    tooltip.style.opacity = \"0\";\n    setTimeout(function() { remove(tooltip); }, 1100);\n  }\n\n  function showError(ts, cm, msg) {\n    if (ts.options.showError)\n      ts.options.showError(cm, msg);\n    else\n      tempTooltip(cm, String(msg), ts);\n  }\n\n  function closeArgHints(ts) {\n    if (ts.activeArgHints) { remove(ts.activeArgHints); ts.activeArgHints = null; }\n  }\n\n  function docValue(ts, doc) {\n    var val = doc.doc.getValue();\n    if (ts.options.fileFilter) val = ts.options.fileFilter(val, doc.name, doc.doc);\n    return val;\n  }\n\n  // Worker wrapper\n\n  function WorkerServer(ts) {\n    var worker = ts.worker = new Worker(ts.options.workerScript);\n    worker.postMessage({type: \"init\",\n                        defs: ts.options.defs,\n                        plugins: ts.options.plugins,\n                        scripts: ts.options.workerDeps});\n    var msgId = 0, pending = {};\n\n    function send(data, c) {\n      if (c) {\n        data.id = ++msgId;\n        pending[msgId] = c;\n      }\n      worker.postMessage(data);\n    }\n    worker.onmessage = function(e) {\n      var data = e.data;\n      if (data.type == \"getFile\") {\n        getFile(ts, data.name, function(err, text) {\n          send({type: \"getFile\", err: String(err), text: text, id: data.id});\n        });\n      } else if (data.type == \"debug\") {\n        window.console.log(data.message);\n      } else if (data.id && pending[data.id]) {\n        pending[data.id](data.err, data.body);\n        delete pending[data.id];\n      }\n    };\n    worker.onerror = function(e) {\n      for (var id in pending) pending[id](e);\n      pending = {};\n    };\n\n    this.addFile = function(name, text) { send({type: \"add\", name: name, text: text}); };\n    this.delFile = function(name) { send({type: \"del\", name: name}); };\n    this.request = function(body, c) { send({type: \"req\", body: body}, c); };\n  }\n});\n"]}